class e{constructor(e={}){this.config={selector:"[data-trigger]",triggerAttribute:"data-trigger",threshold:0,rootMargin:"0px",debounceDelay:10,onChange:null,debug:!1,...e},this.observer=null,this.visibleElements=new Map,this.currentTriggerId=null,this.lastValidTriggerId=null,this._debounceTimer=null,this.instanceId=`scrolly-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,this._diagnosticCache=new Map,this.init()}init(){this.debouncedUpdate=this.debounce(()=>this.updateCurrentTrigger(),this.config.debounceDelay),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.setupObserver(),this.updateCurrentTrigger()}setupObserver(){const e={threshold:this.config.threshold,rootMargin:this.config.rootMargin};this.observer=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target,s=t.getAttribute(this.config.triggerAttribute);e.isIntersecting?this.visibleElements.set(t,s):this.visibleElements.delete(t)}),this.debouncedUpdate()},e);document.querySelectorAll(this.config.selector).forEach(e=>this.observer.observe(e))}updateCurrentTrigger(){const e=Array.from(this.visibleElements.entries());if(e.length>0){const t=e.reduce((e,t)=>{const s=e[0].getBoundingClientRect();return t[0].getBoundingClientRect().top<s.top?t:e})[1];this.lastValidTriggerId=t,this.setCurrentTrigger(t)}else null!==this.lastValidTriggerId&&this.setCurrentTrigger(this.lastValidTriggerId)}setCurrentTrigger(e){if(this.currentTriggerId!==e){const t=this.currentTriggerId;this.currentTriggerId=e,this.emitTriggerChange(e,t)}}emitTriggerChange(e,t){const s={current:e,previous:t,timestamp:Date.now(),instanceId:this.instanceId};"function"==typeof this.config.onChange&&this.config.onChange(s);const i=new CustomEvent("scrollTrigger",{detail:s});window.dispatchEvent(i)}debounce(e,t){return(...s)=>{clearTimeout(this._debounceTimer),this._debounceTimer=setTimeout(()=>e.apply(this,s),t)}}getCurrentTriggerId(){return this.currentTriggerId}observe(e){this.observer&&e&&this.observer.observe(e)}unobserve(e){this.observer&&e&&(this.observer.unobserve(e),this.visibleElements.delete(e))}destroy(){this._debounceTimer&&clearTimeout(this._debounceTimer),this.observer&&this.observer.disconnect(),this.visibleElements.clear(),this.currentTriggerId=null,this.lastValidTriggerId=null,this._diagnosticCache.clear()}diagnose(e=!1){const t=`diagnose_${e}`;if(this._diagnosticCache.has(t))return this._diagnosticCache.get(t);const s=[],i=document.querySelectorAll(this.config.selector),n=this.validateElements();s.push(...n);const r=this.checkPerformance();s.push(...r);const o=this._checkEnvironment();s.push(...o);const g={status:this._determineStatus(s),issues:s,summary:{totalElements:i.length,problematicElements:this._countProblematicElements(s),performanceScore:this._calculatePerformanceScore(s),timestamp:Date.now()}};return(this.config.debug||e)&&this._outputDiagnosticResults(g),this._diagnosticCache.set(t,g),setTimeout(()=>{this._diagnosticCache.delete(t)},5e3),g}validateElements(){const e=[],t=document.querySelectorAll(this.config.selector),s=new Set,i=window.innerHeight;return 0===t.length?(e.push({type:"no_elements",severity:"error",message:"ç›£è¦–å¯¾è±¡è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",suggestion:`ã‚»ãƒ¬ã‚¯ã‚¿ "${this.config.selector}" ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’è¿½åŠ ã—ã¦ãã ã•ã„`}),e):(t.forEach((t,n)=>{const r=t.getAttribute(this.config.triggerAttribute);t.getBoundingClientRect();const o=window.getComputedStyle(t);r?s.has(r)?e.push({type:"duplicate_trigger_id",severity:"error",message:`ãƒˆãƒªã‚¬ãƒ¼ID "${r}" ãŒé‡è¤‡ã—ã¦ã„ã¾ã™`,element:t,suggestion:"å„è¦ç´ ã«ã¯ä¸€æ„ã®ãƒˆãƒªã‚¬ãƒ¼IDã‚’è¨­å®šã—ã¦ãã ã•ã„"}):s.add(r):e.push({type:"missing_trigger_id",severity:"error",message:`è¦ç´  ${n+1} ã«ãƒˆãƒªã‚¬ãƒ¼IDå±æ€§ãŒã‚ã‚Šã¾ã›ã‚“`,element:t,suggestion:`${this.config.triggerAttribute}="unique-id" ã‚’è¿½åŠ ã—ã¦ãã ã•ã„`});const g=t.offsetHeight;g<.5*i&&e.push({type:"insufficient_height",severity:"warning",message:`è¦ç´  "${r||n+1}" ã®é«˜ã•ãŒä¸ååˆ†ã§ã™ (${g}px)`,element:t,suggestion:"min-height: 100vh ã¾ãŸã¯ãã‚Œä»¥ä¸Šã®é«˜ã•ã‚’è¨­å®šã—ã¦ãã ã•ã„"}),"none"===o.display?e.push({type:"element_hidden",severity:"error",message:`è¦ç´  "${r||n+1}" ãŒ display: none ã§éè¡¨ç¤ºã§ã™`,element:t,suggestion:"display: none ã®ä»£ã‚ã‚Šã« visibility: hidden ã¾ãŸã¯ opacity: 0 ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„"}):"hidden"===o.visibility&&e.push({type:"element_visibility_hidden",severity:"warning",message:`è¦ç´  "${r||n+1}" ãŒ visibility: hidden ã§ã™`,element:t,suggestion:"IntersectionObserverã¯ç›£è¦–ã—ã¾ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ãˆã¾ã›ã‚“"}),"fixed"===o.position&&e.push({type:"fixed_position",severity:"warning",message:`è¦ç´  "${r||n+1}" ãŒ position: fixed ã§ã™`,element:t,suggestion:"ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã®è¨ˆç®—ã«å½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™"})}),e)}checkPerformance(){const e=[],t=document.querySelectorAll(this.config.selector);return t.length>50&&e.push({type:"too_many_elements",severity:"warning",message:`ç›£è¦–å¯¾è±¡è¦ç´ ãŒå¤šã™ãã¾ã™ (${t.length}å€‹)`,suggestion:"50å€‹ä»¥ä¸‹ã«æŠ‘ãˆã‚‹ã‹ã€æ®µéšçš„ãªè¦ç´ è¿½åŠ ã‚’æ¤œè¨ã—ã¦ãã ã•ã„"}),Array.isArray(this.config.threshold)&&this.config.threshold.length>5?e.push({type:"complex_threshold",severity:"warning",message:`thresholdé…åˆ—ãŒè¤‡é›‘ã™ãã¾ã™ (${this.config.threshold.length}å€‹ã®å€¤)`,suggestion:"å˜ä¸€ã®å€¤ã¾ãŸã¯æœ€å¤§5å€‹ã¾ã§ã®é…åˆ—ã‚’æ¨å¥¨ã—ã¾ã™"}):1===this.config.threshold&&e.push({type:"high_threshold",severity:"warning",message:"threshold: 1.0 ã¯è¦ç´ ãŒå®Œå…¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§ç™ºç«ã—ã¾ã›ã‚“",suggestion:"0.1 - 0.5 ç¨‹åº¦ã®å€¤ã‚’æ¨å¥¨ã—ã¾ã™"}),this.config.debounceDelay>100?e.push({type:"high_debounce",severity:"info",message:`debounceDelay ãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ (${this.config.debounceDelay}ms)`,suggestion:"å¿œç­”æ€§ã‚’é‡è¦–ã™ã‚‹å ´åˆã¯50msä»¥ä¸‹ã‚’æ¨å¥¨ã—ã¾ã™"}):this.config.debounceDelay<5&&e.push({type:"low_debounce",severity:"info",message:`debounceDelay ãŒå°ã•ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ (${this.config.debounceDelay}ms)`,suggestion:"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’é‡è¦–ã™ã‚‹å ´åˆã¯10msä»¥ä¸Šã‚’æ¨å¥¨ã—ã¾ã™"}),e}_checkEnvironment(){const e=[];Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)<=window.innerHeight&&e.push({type:"no_scroll",severity:"error",message:"ãƒšãƒ¼ã‚¸ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸å¯èƒ½ã§ã™",suggestion:"ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é«˜ã•ã‚’å¢—ã‚„ã™ã‹ã€overflowè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„"});const t=window.getComputedStyle(document.body),s=window.getComputedStyle(document.documentElement);"hidden"!==t.overflow&&"hidden"!==s.overflow||e.push({type:"overflow_hidden",severity:"error",message:"body ã¾ãŸã¯ html ã« overflow: hidden ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™",suggestion:"overflow-x: hidden ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€overflowè¨­å®šã‚’å‰Šé™¤ã—ã¦ãã ã•ã„"});return document.querySelector('meta[name="viewport"]')||e.push({type:"no_viewport_meta",severity:"warning",message:"ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆãƒ¡ã‚¿ã‚¿ã‚°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“",suggestion:'<meta name="viewport" content="width=device-width, initial-scale=1.0"> ã‚’è¿½åŠ ã—ã¦ãã ã•ã„'}),window.IntersectionObserver||e.push({type:"no_intersection_observer",severity:"error",message:"IntersectionObserverãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“",suggestion:"ãƒãƒªãƒ•ã‚£ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã‹ã€å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„"}),e}_determineStatus(e){return e.some(e=>"error"===e.severity)?"error":e.some(e=>"warning"===e.severity)?"warning":"ok"}_countProblematicElements(e){const t=new Set;return e.forEach(e=>{e.element&&t.add(e.element)}),t.size}_calculatePerformanceScore(e){let t=10;return e.forEach(e=>{switch(e.severity){case"error":t-=3;break;case"warning":t-=1;break;case"info":t-=.5}}),Math.max(0,t)}_outputDiagnosticResults(e){console.group(`${{ok:"âœ…",warning:"âš ï¸",error:"âŒ"}[e.status]} Scrolltering è¨ºæ–­çµæœ (ID: ${this.instanceId.split("-").pop()})`),console.log("ğŸ“Š æ¦‚è¦:",e.summary),e.issues.length>0?(console.group("ğŸ” æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ:"),e.issues.forEach((e,t)=>{console.log(`${{error:"ğŸš«",warning:"âš ï¸",info:"â„¹ï¸"}[e.severity]} ${e.message}`),console.log(`   ğŸ’¡ ${e.suggestion}`),e.element&&console.log("   ğŸ¯ è¦ç´ :",e.element)}),console.groupEnd()):console.log("âœ¨ å•é¡Œã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"),console.groupEnd()}}
/**
 * Simple Scrolly Triggering System
 * 
 * @version 1.0.0
 * @author Your Name
 * @license MIT
 */export{e as default};
